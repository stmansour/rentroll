<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" type="text/css" href="/js/w2ui-1.5.rc1.min.css" />
    <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script> -->
    <script src="/js/jquery.min.js"></script>
    <script src="/js/w2ui-1.5.rc1.js"></script>
    <script src="https://use.fontawesome.com/6e18d0f7c3.js"></script>
    <link rel="icon" type="image/png" href="/html/images/favicon32x32.png">
</head>
<body>
<script type="text/javascript">
function buildURL() {
    "use strict";
    var s = document.getElementById("rrHostAddr").value;
    if (s.slice(-1) == '/') {
        s = s.slice(0, -1);
    }
    var svc = document.getElementById("rrWebService").value;
    if (svc[0] != '/') {
        svc = '/' + svc;
    }
    return s + svc;
}

$(function () {
    "use strict";
    var pstyle = 'border: 1px solid #dfdfdf; padding: 5px;';
    var whitebg = 'border: 1px solid #dfdfdf; padding: 5px; background-color: white;';

    $().w2toolbar({
        name: 'testtoolbar',
        items: [
            { type: 'button', id: 'minify',   caption: 'Minify',   icon: 'fa fa-download'},
            { type: 'button', id: 'encode',   caption: 'Encode',   icon: 'fa fa-expand'},
            { type: 'button', id: 'decode',   caption: 'Decode',   icon: 'fa fa-compress'},
            { type: 'button', id: 'beautify', caption: 'Beautify', icon: 'fa fa-indent'},
            { type: 'button', id: 'clearall', caption: 'Clear All',icon: 'fa fa-times-circle'},
            { type: 'break',  id: 'break1' },
            { type: 'button', id: 'sendpost', text: 'Send POST', icon: 'fa fa-arrow-circle-o-up' },
            { type: 'button', id: 'sendget', text: 'Send GET', icon: 'fa fa-arrow-circle-up' },
            { type: 'spacer', id: 'bt3' },
            { type: 'button', id: 'btnClose', icon: 'fa fa-times' },

        ],
        onClick: function (event) {
            var s;
            var url;
            switch(event.target) {
                case 'minify':
                    s = document.getElementById("rrSendThis").value;
                    document.getElementById("rrSendThis").value = JSON.stringify(JSON.parse(s));
                    break;
                case 'encode':
                    s = document.getElementById("rrSendThis").value;
                    document.getElementById("rrSendThis").value = encodeURIComponent(s); // the web address portion is kept elsewhere
                    break;
                case 'decode':
                    s = document.getElementById("rrSendThis").value;
                    document.getElementById("rrSendThis").value = decodeURIComponent(s);
                    break;
               case 'beautify':
                    s = document.getElementById("rrSendThis").value;
                    document.getElementById("rrSendThis").value = JSON.stringify(JSON.parse(s),null,4);
                    break;
               case 'clearall':
                    document.getElementById("rrSendThis").value = '';
                    document.getElementById("rrWebService").value = '';
                    document.getElementById("rrResponseStatus").value = '';
                    document.getElementById("rrResponse").value = '';
                    break;
                case 'sendget':
                    url = buildURL();
                    console.log('url = '+url);
                    $.get(url)
                    .done( function(data,status){
                        document.getElementById("rrResponseStatus").value = status;
                        document.getElementById("rrResponse").value = data;
                    })
                    .fail( function() { 
                        console.log('Error getting /v1/uilists');
                     });
                    break;
                case 'sendpost':
                    url = buildURL();
                    var data = document.getElementById("rrSendThis").value;
                    $.post(url, data, function(data,status) {
                        document.getElementById("rrResponse").value = JSON.stringify(data,0,4);
                        document.getElementById("rrResponseStatus").value = status;
                    });
                    break;
                case 'btnClose':
                    w2ui.layout.toggle('preview', true);
                    break;
            }
        },
    });

    $('#layout').w2layout({
        name: 'testerLayout',
        panels: [
            { type: 'top', size: 34, style: pstyle, content: w2ui.testtoolbar },
            { type: 'main', size: '100%', style: whitebg, content: 'main' },
        ]
    });

    $('#layout').w2layout({
        name: 'layout',
        panels: [
            { type: 'top', size: 75, style: pstyle, content: 'top' },
            { type: 'left', size: 260, style: pstyle, content: 'left' },
            { type: 'main', style: whitebg, content: 'main' },
            { type: 'preview', size: '50%', resizable: true, style: whitebg, content: w2ui.testerLayout },
        ]
    });

    w2ui.layout.content('top', $().w2toolbar({
		    name: 'toptoolbar',
		    items: [
		        { type: 'html',  id: 'title',
		            html: '<div style="padding: 4px 0px; font-size: 8pt;">'+
		                  '<h2 class=>RentRoll Web Service API&nbsp;&nbsp;&nbsp;</h2>'+
		                  '<p style="color: #777777;"><br>API Version: {{.Version}}<br>Generated: {{.Date}}</p>'+
		                  '</div>' 
		        },
                { type: 'button', id: 'tester', text: 'Test Window', icon: 'fa fa-star' },

		    ],
            onClick: function(event) {
                switch (event.target) {
                    case 'tester':
                        w2ui.layout.toggle('preview', true);
                }
            }
		})
	);

    w2ui.layout.content('left',$().w2sidebar({
        name: 'sidebar',
        nodes: [
            { id: 'apis', text: 'API Calls', img: 'icon-folder', expanded: true, group: true,
                nodes: [ 
                {{range .TOC}}{id: '{{.ID}}', text: '{{.Title}}'},{{end}}
                ]
            },
        ],
        onClick: function (event) {
            console.log('event.target = ' + event.target);
            switch(event.target) {
                {{range .TOC}}case '{{.ID}}': w2ui.layout.load('main', '/doc/{{.Filename}}'); break; {{end}}
                default:
                    console.log('unhandled event: ' + event.target);
            }
        }
    }));
    {{$d := index .TOC 0}}
    w2ui.sidebar.select('{{$d.ID}}'); // select the first doc automatically
    w2ui.sidebar.click('{{$d.ID}}'); // show the first doc automatically
    w2ui.testerLayout.load('main', '/doc/tester.html')
});


</script>
<div id="layout"style="position: absolute; top: 0px; left: 0px; bottom: 0px; right: 0px;"></div>
</body>
</html>